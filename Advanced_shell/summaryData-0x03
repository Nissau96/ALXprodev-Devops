#!/bin/bash

# summaryData-0x03
# Script to generate a CSV report from PokÃ©mon JSON data

# Configuration
INPUT_DIR="pokemon_data"
OUTPUT_FILE="pokemon_report.csv"
TEMP_FILE=".temp_stats"

# Header
echo "Name,Height (m),Weight (kg)" > "$OUTPUT_FILE"

# Initialize totals
total_height=0
total_weight=0
count=0

# Process each JSON file
for json_file in "$INPUT_DIR"/*.json; do
    if [[ -f "$json_file" ]]; then
        # Extract data using jq
        name=$(jq -r '.name' "$json_file")
        height=$(jq -r '.height / 10' "$json_file")  # Convert from dm to m
        weight=$(jq -r '.weight / 10' "$json_file")  # Convert from hg to kg

        # Add to CSV
        echo "$name,$height,$weight" >> "$OUTPUT_FILE"

        # Calculate totals for averages
        total_height=$(awk "BEGIN {print $total_height + $height}")
        total_weight=$(awk "BEGIN {print $total_weight + $weight}")
        ((count++))
    fi
done

# Calculate averages
avg_height=$(awk "BEGIN {printf \"%.2f\", $total_height / $count}")
avg_weight=$(awk "BEGIN {printf \"%.2f\", $total_weight / $count}")

# Output results
echo -e "\nCSV Report generated at: $OUTPUT_FILE\n"
cat "$OUTPUT_FILE"

echo -e "\nAverage Height: $avg_height m"
echo "Average Weight: $avg_weight kg"

# Cleanup
rm -f "$TEMP_FILE"