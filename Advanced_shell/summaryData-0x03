#!/bin/bash

# summaryData-0x03
# Script to generate a CSV report from PokÃ©mon JSON data using awk for calculations

# Configuration
INPUT_DIR="pokemon_data"
OUTPUT_FILE="pokemon_report.csv"

# Header
echo "Name,Height (m),Weight (kg)" > "$OUTPUT_FILE"

# Process each JSON file and collect data for averages
{
    # Print header
    echo "Name,Height,Weight"
    
    # Process each JSON file
    for json_file in "$INPUT_DIR"/*.json; do
        if [[ -f "$json_file" ]]; then
            # Extract data using jq
            name=$(jq -r '.name' "$json_file")
            height=$(jq -r '.height / 10' "$json_file")  # Convert from dm to m
            weight=$(jq -r '.weight / 10' "$json_file")  # Convert from hg to kg

            # Add to CSV
            echo "$name,$height,$weight" >> "$OUTPUT_FILE"
            
            # Output for awk processing
            echo "$name,$height,$weight"
        fi
    done
} | awk -F, '
    NR == 1 { next }  # Skip header
    {
        # Accumulate totals
        total_height += $2
        total_weight += $3
        count++
        
        # Store all records for potential future processing
        records[count] = $0
    }
    END {
        # Calculate averages
        avg_height = total_height / count
        avg_weight = total_weight / count
        
        # Print results
        printf "\nAverage Height: %.2f m\n", avg_height
        printf "Average Weight: %.2f kg\n", avg_weight
    }
'

# Output CSV location
echo -e "\nCSV Report generated at: $OUTPUT_FILE\n"
cat "$OUTPUT_FILE"