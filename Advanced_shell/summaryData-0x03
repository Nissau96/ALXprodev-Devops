#!/bin/bash

# summaryData-0x03
# Script to generate a CSV report from PokÃ©mon JSON data

# Configuration
INPUT_DIR="pokemon_data"
OUTPUT_FILE="pokemon_report.csv"

# Initialize CSV header
echo "Name,Height (m),Weight (kg)" > "$OUTPUT_FILE"

# Process files and calculate averages using awk
awk -F, '
BEGIN {
    print "Name,Height (m),Weight (kg)" > "'"$OUTPUT_FILE"'"
    total_height = 0
    total_weight = 0
    count = 0
}
{
    # Process each JSON file
    cmd = "jq -r '\''.name,.height/10,.weight/10'\'' " $0
    while ((cmd | getline result) > 0) {
        if (NR % 3 == 1) name = result
        if (NR % 3 == 2) height = result
        if (NR % 3 == 0) {
            weight = result
            print name "," height "," weight >> "'"$OUTPUT_FILE"'"
            total_height += height
            total_weight += weight
            count++
        }
    }
    close(cmd)
}
END {
    avg_height = total_height / count
    avg_weight = total_weight / count
    print "\nAverage Height: " avg_height " m"
    print "Average Weight: " avg_weight " kg"
}' < <(find "$INPUT_DIR" -name "*.json" -type f)

# Output CSV location
echo -e "\nCSV Report generated at: $OUTPUT_FILE"